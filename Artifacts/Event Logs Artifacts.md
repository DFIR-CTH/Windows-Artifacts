## üìù Event Logs Artifacts

### User Logons

| **Field** | **Details** |
|-----------|-------------|
| **Purpose** | Track successful and failed user authentication attempts on Windows systems. Monitor account usage, detect unauthorized access, and identify compromised accounts. |
| **Key Characteristics** | ‚Ä¢ **Event ID 4624**: Successful logon with logon type classification<br>‚Ä¢ **Event ID 4625**: Failed logon (wrong password, unknown user, locked account)<br>‚Ä¢ **Event ID 4634/4647**: Successful logoff<br>‚Ä¢ **Event ID 4672**: Special privileges assigned (admin rights)<br>‚Ä¢ **Event ID 4720**: User account created<br>‚Ä¢ **Event ID 4726**: User account deleted<br>‚Ä¢ Contains: Username, Domain, Logon Type, Source IP, Timestamp, Logon ID (session correlation) |
| **Locations** | **Event Log Files:**<br>`%SystemRoot%\System32\Winevt\Logs\Security.evtx`<br><br>**Registry Audit Policy:**<br>`HKLM\SYSTEM\CurrentControlSet\Control\Lsa\AuditLogonEvents`<br><br>**Default Path:**<br>`C:\Windows\System32\winevt\Logs\Security.evtx` |
| **Parsing Steps** | 1. Extract Security.evtx using forensic tool or from live system<br>2. Filter events by relevant IDs:<br>   - 4624 (successful logon)<br>   - 4625 (failed logon)<br>   - 4634/4647 (logoff)<br>   - 4672 (admin privileges)<br>3. Parse Event ID 4624 for successful logons:<br>   - Extract username, domain, Logon Type<br>   - Identify Logon Type: 2=Interactive, 3=Network, 10=RDP, 5=Service<br>   - Record source IP address and workstation name<br>   - Note LogonID for session correlation<br>4. Parse Event ID 4625 for failed attempts:<br>   - Count failures per account (brute-force detection)<br>   - Identify failure reasons (bad password, locked account)<br>   - Track source IPs<br>5. Correlate LogonID across events for session reconstruction<br>6. Build timeline of authentication activity<br>7. Identify anomalies (off-hours access, unusual IPs, lateral movement) |
| **Tools** | ‚Ä¢ **Event Log Explorer** - GUI-based EVTX viewer<br>‚Ä¢ **EvtxECmd** (Eric Zimmerman) - Command-line parser<br>‚Ä¢ **Chainsaw** - Threat hunting in Windows event logs<br>‚Ä¢ **Splunk** - SIEM correlation and alerting<br>‚Ä¢ **ELK Stack** (Elasticsearch, Logstash, Kibana) - Log aggregation<br>‚Ä¢ **Hayabusa** - Fast event log forensics<br>‚Ä¢ **Autopsy** - Timeline integration<br>‚Ä¢ **Event Viewer** (Windows native) - Manual inspection |
| **Additional Info** | ‚Ä¢ Logon Type 3 (Network) used by RDP with NLA enabled initially<br>‚Ä¢ Logon Type 10 (RemoteInteractive) indicates actual RDP session<br>‚Ä¢ Failed logon surges (Event 4625) indicate brute-force attacks<br>‚Ä¢ SubjectLogonID and TargetLogonID enable session tracking<br>‚Ä¢ Event ID 4672 after 4624 confirms admin privilege escalation<br>‚Ä¢ Account lockout (Event 4740) follows excessive failed attempts<br>‚Ä¢ Lateral movement: multiple 4624 events across systems with same credentials<br>‚Ä¢ Critical for compliance (PCI-DSS, HIPAA, SOX) and incident response |

---

### RDP Usage

| **Field** | **Details** |
|-----------|-------------|
| **Purpose** | Track Remote Desktop Protocol connections including connection attempts, authentications, session activity, and disconnections. Identify remote access by attackers or authorized users. |
| **Key Characteristics** | ‚Ä¢ **Event ID 1149**: RDP network connection established (NOT authentication)<br>‚Ä¢ **Event ID 4624** (Type 10): Successful RDP logon<br>‚Ä¢ **Event ID 4625** (Type 10): Failed RDP logon attempt<br>‚Ä¢ **Event ID 21/22**: New RDP session created<br>‚Ä¢ **Event ID 24**: Session disconnected<br>‚Ä¢ **Event ID 25**: Session reconnected<br>‚Ä¢ **Event ID 4778/4779**: Session reconnection/disconnection (also Fast User Switching)<br>‚Ä¢ Contains: Username, Source IP, Session ID, Timestamps |
| **Locations** | **Security Log:**<br>`C:\Windows\System32\winevt\Logs\Security.evtx`<br>Events: 4624, 4625, 4778, 4779<br><br>**TerminalServices-RemoteConnectionManager:**<br>`C:\Windows\System32\winevt\Logs\Microsoft-Windows-TerminalServices-RemoteConnectionManager%4Operational.evtx`<br>Event: 1149 (user authentication/IP address)<br><br>**TerminalServices-LocalSessionManager:**<br>`C:\Windows\System32\winevt\Logs\Microsoft-Windows-TerminalServices-LocalSessionManager%4Operational.evtx`<br>Events: 21, 22, 24, 25<br><br>**RDP Client Artifacts (Source Machine):**<br>`C:\Windows\System32\winevt\Logs\Microsoft-Windows-TerminalServices-RDPClient%4Operational.evtx`<br>Events: 1024 (successful connection), 1102 (destination IP) |
| **Parsing Steps** | 1. **Extract relevant event logs** from target system:<br>   - Security.evtx<br>   - TerminalServices-RemoteConnectionManager%4Operational.evtx<br>   - TerminalServices-LocalSessionManager%4Operational.evtx<br>2. **Filter Event ID 1149** (RemoteConnectionManager):<br>   - Extract username and source IP<br>   - Note: This indicates connection to login screen, NOT successful auth<br>3. **Filter Event ID 4624** (Security log, Logon Type 10):<br>   - Successful RDP authentication<br>   - Extract username, domain, source IP, LogonID<br>4. **Filter Event IDs 21/22** (LocalSessionManager):<br>   - Confirm session creation<br>   - Extract username, session ID, source IP<br>5. **Track session lifecycle:**<br>   - Event 24: Disconnection<br>   - Event 25: Reconnection<br>   - Event 4778/4779: Session reconnection/disconnection<br>6. **Correlate events across logs:**<br>   - Match source IPs and usernames<br>   - Build timeline of RDP session activity<br>7. **Analyze for threats:**<br>   - Multiple 1149 without authentication = connection scanning<br>   - Failed RDP attempts (4625 Type 10) = brute-force<br>   - Unusual source IPs or off-hours access<br>   - Nested RDP connections |
| **Tools** | ‚Ä¢ **EvtxECmd** (Eric Zimmerman) - Parse EVTX files<br>‚Ä¢ **RDP Log Parser** - Specialized RDP event correlation<br>‚Ä¢ **Chainsaw** - Hunt RDP artifacts with sigma rules<br>‚Ä¢ **Splunk/ELK** - SIEM correlation across multiple logs<br>‚Ä¢ **Event Log Explorer** - GUI analysis<br>‚Ä¢ **Hayabusa** - Fast RDP session reconstruction<br>‚Ä¢ **Magnet AXIOM** - Timeline correlation<br>‚Ä¢ **BMC-Tools / RdpCacheStitcher** - Reconstruct RDP bitmap cache screenshots |
| **Additional Info** | ‚Ä¢ **Event 1149 is misleading**: "User authentication succeeded" only means connection to login screen<br>‚Ä¢ NLA (Network Level Authentication) initially logs as Logon Type 3, then Type 10<br>‚Ä¢ RDP bitmap cache files: `%APPDATA%\Microsoft\Terminal Server Client\Cache\` - can reconstruct viewed screens<br>‚Ä¢ Registry: `HKCU\Software\Microsoft\Terminal Server Client\Servers` - RDP connection history<br>‚Ä¢ Memory forensics: Extract RDP encryption keys to replay sessions<br>‚Ä¢ Clipboard data in rdpclip.exe process may contain passwords<br>‚Ä¢ Event 4778/4779 also triggered by Fast User Switching (SessionName = "Console")<br>‚Ä¢ Critical for APT investigations, insider threat, lateral movement detection |

---

### RunAs Events

| **Field** | **Details** |
|-----------|-------------|
| **Purpose** | Track logon attempts using explicit credentials different from current logged-on user. Detect privilege escalation, lateral movement, and credential misuse via RunAs command or "Run as administrator" actions. |
| **Key Characteristics** | ‚Ä¢ **Event ID 4648**: Logon attempted with explicit credentials<br>‚Ä¢ Captures both Subject User (who initiated) and Target User (credentials used)<br>‚Ä¢ Records process name triggering the action<br>‚Ä¢ Contains source IP address for remote attempts<br>‚Ä¢ Commonly triggered by: RunAs command, scheduled tasks, RDP with alternate creds, service execution<br>‚Ä¢ Logged on ORIGINATING system (not target) |
| **Locations** | **Security Log:**<br>`%SystemRoot%\System32\Winevt\Logs\Security.evtx`<br><br>**Default Path:**<br>`C:\Windows\System32\winevt\Logs\Security.evtx`<br><br>**Registry Audit Policy:**<br>`HKLM\SYSTEM\CurrentControlSet\Control\Lsa\AuditLogonEvents` |
| **Parsing Steps** | 1. Extract Security.evtx using forensic tool<br>2. Filter for Event ID 4648<br>3. Parse event fields:<br>   - **Subject User**: Account that initiated the action (current logged-on user)<br>   - **Subject Domain**: Domain of initiating account<br>   - **Subject LogonID**: Session ID for correlation<br>   - **Target User**: Account credentials being used<br>   - **Target Domain**: Domain of target account<br>   - **Process Name**: Application initiating the action<br>   - **IP Address**: Source IP (if remote)<br>4. Identify common legitimate processes:<br>   - mstsc.exe (RDP client)<br>   - services.exe (service startup)<br>   - svchost.exe (system services)<br>   - winlogon.exe (interactive logon)<br>5. Flag suspicious indicators:<br>   - cmd.exe, powershell.exe with explicit credentials<br>   - sc.exe (service creation for persistence)<br>   - Unknown source IPs<br>   - Admin credentials used by non-admin accounts<br>6. Correlate with Event 4624 on target systems (lateral movement)<br>7. Build credential usage timeline |
| **Tools** | ‚Ä¢ **EvtxECmd** (Eric Zimmerman) - Parse Security.evtx<br>‚Ä¢ **Chainsaw** - Sigma rules for RunAs abuse detection<br>‚Ä¢ **Splunk** - SIEM correlation with lateral movement<br>‚Ä¢ **ELK Stack** - Aggregate 4648 across multiple hosts<br>‚Ä¢ **Event Log Explorer** - GUI filtering and analysis<br>‚Ä¢ **Hayabusa** - Fast threat hunting<br>‚Ä¢ **Velociraptor** - Endpoint query for 4648 events |
| **Additional Info** | ‚Ä¢ Event 4648 logged on SOURCE system, not destination<br>‚Ä¢ Provides reverse view of lateral movement (where user was headed FROM this system)<br>‚Ä¢ Frequent 4648 events = potential attacker moving laterally across network<br>‚Ä¢ Legitimate use cases: scheduled tasks under service accounts, remote management<br>‚Ä¢ Spike in 4648 with cmd.exe/powershell.exe = credential theft or pass-the-hash<br>‚Ä¢ Can track attacker's path across compromised systems<br>‚Ä¢ Combine with 4624 (destination) and 4672 (privilege use) for full picture<br>‚Ä¢ Critical for scoping incident (identifying all affected systems) |

---

### Process Tracking

| **Field** | **Details** |
|-----------|-------------|
| **Purpose** | Monitor process creation and termination on Windows systems. Track program execution including command-line arguments, parent processes, and user context to detect malicious activity. |
| **Key Characteristics** | ‚Ä¢ **Event ID 4688**: New process created<br>‚Ä¢ **Event ID 4689**: Process terminated<br>‚Ä¢ Captures: Process name, Process ID (PID), Parent Process ID (PPID), command-line arguments<br>‚Ä¢ Records user context (who ran the process)<br>‚Ä¢ Command-line logging must be enabled via Group Policy<br>‚Ä¢ Contains LogonID for session correlation<br>‚Ä¢ Tracks both user-initiated and system-spawned processes |
| **Locations** | **Security Log:**<br>`%SystemRoot%\System32\Winevt\Logs\Security.evtx`<br><br>**Default Path:**<br>`C:\Windows\System32\winevt\Logs\Security.evtx`<br><br>**Enable Command-Line Logging:**<br>Group Policy: `Computer Configuration ‚Üí Policies ‚Üí Administrative Templates ‚Üí System ‚Üí Audit Process Creation`<br>Enable: "Include command line in process creation events"<br><br>**Registry Key:**<br>`HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit\ProcessCreationIncludeCmdLine_Enabled` |
| **Parsing Steps** | 1. Extract Security.evtx using forensic tool<br>2. Filter for Event ID 4688 (process creation)<br>3. Parse critical fields:<br>   - **Subject User SID/Name**: Account that created process<br>   - **New Process ID**: Unique PID for tracking<br>   - **New Process Name**: Full path to executable<br>   - **Creator Process ID**: Parent process PID<br>   - **Creator Process Name**: Parent executable path<br>   - **Command Line**: Full arguments (if enabled)<br>4. Identify suspicious parent-child relationships:<br>   - cmd.exe spawned by winword.exe (macro malware)<br>   - powershell.exe child of Excel, Word (malicious document)<br>   - Unexpected children of explorer.exe<br>5. Analyze command-line arguments:<br>   - Encoded PowerShell commands (-enc, -EncodedCommand)<br>   - Suspicious scripts (certutil, bitsadmin for download)<br>   - LOLBins (Living off the Land Binaries) abuse<br>6. Track process chains (parent ‚Üí child ‚Üí grandchild)<br>7. Identify processes from unusual locations (not System32, Program Files)<br>8. Correlate PIDs with Event 4689 (termination) for lifespan<br>9. Cross-reference with Prefetch, Amcache for execution validation |
| **Tools** | ‚Ä¢ **EvtxECmd** (Eric Zimmerman) - Parse and filter Security.evtx<br>‚Ä¢ **Chainsaw** - Detect malicious process patterns with sigma rules<br>‚Ä¢ **Hayabusa** - Fast process tree reconstruction<br>‚Ä¢ **Splunk/ELK** - SIEM for process correlation and alerting<br>‚Ä¢ **Velociraptor** - Hunt malicious process execution across fleet<br>‚Ä¢ **Event Log Explorer** - GUI for manual analysis<br>‚Ä¢ **ProcMon** (Sysinternals) - Real-time process monitoring<br>‚Ä¢ **Sysmon** (supplement) - Enhanced process logging with network, file, registry activity |
| **Additional Info** | ‚Ä¢ Command-line logging NOT enabled by default (must configure GPO)<br>‚Ä¢ Event 4688 alone insufficient without command-line data<br>‚Ä¢ Malicious indicators: Processes from Temp folders, encoded PowerShell, WMIC abuse<br>‚Ä¢ Parent-child mismatches: Different process trees than expected<br>‚Ä¢ LOLBins: rundll32.exe, regsvr32.exe, mshta.exe spawning child processes<br>‚Ä¢ Sysmon Event ID 1 provides superior detail (hashes, network, parent command-line)<br>‚Ä¢ Process termination (4689) helps calculate execution duration<br>‚Ä¢ Critical for malware detection, lateral movement, and privilege escalation<br>‚Ä¢ Combine with Prefetch (first/last run) and Amcache (execution history) |

---

### PowerShell Logs

| **Field** | **Details** |
|-----------|-------------|
| **Purpose** | Record PowerShell command execution, script blocks, and module activity to detect fileless malware, obfuscated attacks, and malicious PowerShell usage. |
| **Key Characteristics** | ‚Ä¢ **Event ID 4103**: Module Logging - records pipeline execution, obfuscated commands, variables<br>‚Ä¢ **Event ID 4104**: Script Block Logging - captures full script content, deobfuscates at runtime<br>‚Ä¢ **Event ID 4105**: Script block logging start/stop events<br>‚Ä¢ Script Block Logging splits large scripts into multiple 4104 events (MessageNumber/MessageTotal)<br>‚Ä¢ Automatic logging triggers on suspicious terms (Microsoft's list)<br>‚Ä¢ Global Script Block Logging captures ALL PowerShell activity<br>‚Ä¢ Module Logging tracks cmdlet and function calls |
| **Locations** | **PowerShell Operational Log:**<br>`C:\Windows\System32\winevt\Logs\Microsoft-Windows-PowerShell%4Operational.evtx`<br>Events: 4103, 4104, 4105<br><br>**Classic PowerShell Log:**<br>`C:\Windows\System32\winevt\Logs\Windows PowerShell.evtx`<br>Event: 800 (Pipeline execution details)<br><br>**Enable Logging via Group Policy:**<br>`Computer Configuration ‚Üí Policies ‚Üí Administrative Templates ‚Üí Windows Components ‚Üí Windows PowerShell`<br>- Enable Module Logging<br>- Enable Script Block Logging<br>- Enable Transcription (optional, saves to text files)<br><br>**Transcript Log Path (if enabled):**<br>`C:\PSLogs\` (or custom configured path) |
| **Parsing Steps** | 1. Extract PowerShell event logs:<br>   - Microsoft-Windows-PowerShell%4Operational.evtx<br>   - Windows PowerShell.evtx<br>2. **Parse Event ID 4104 (Script Block Logging):**<br>   - Extract ScriptBlockText field (contains code)<br>   - Check MessageNumber and MessageTotal for multi-event scripts<br>   - Reassemble split script blocks in sequence<br>   - Look for deobfuscated content (runtime decoding)<br>   - Identify suspicious patterns: encoded commands, download cradles, Invoke-Expression<br>3. **Parse Event ID 4103 (Module Logging):**<br>   - Extract pipeline execution details<br>   - Identify cmdlet usage (Get-ChildItem, Invoke-WebRequest, etc.)<br>   - Track obfuscated commands and aliases (gci instead of Get-ChildItem)<br>4. **Analyze for malicious indicators:**<br>   - Encoded commands: -EncodedCommand, -enc, FromBase64String<br>   - Download cradles: Net.WebClient, Invoke-WebRequest, DownloadString<br>   - Execution policy bypass: -ExecutionPolicy Bypass<br>   - Obfuscation: backticks, variable concatenation, string manipulation<br>   - Suspicious modules: Invoke-Mimikatz, PowerSploit, Empire<br>5. Correlate with Event 4688 (process creation) for parent process context<br>6. Extract Script Block ID to group related events<br>7. Identify Security User ID (SID) for attribution |
| **Tools** | ‚Ä¢ **EvtxECmd** (Eric Zimmerman) - Parse PowerShell logs<br>‚Ä¢ **Chainsaw** - Sigma rules for PowerShell attack detection<br>‚Ä¢ **Splunk/ELK** - Aggregate and alert on suspicious PowerShell<br>‚Ä¢ **DeepBlueCLI** - PowerShell threat hunting script<br>‚Ä¢ **Hayabusa** - Fast PowerShell artifact analysis<br>‚Ä¢ **Event Log Explorer** - GUI inspection<br>‚Ä¢ **PowerShell Empire Detector** - Identify C2 framework usage<br>‚Ä¢ **Velociraptor** - Hunt PowerShell abuse across endpoints |
| **Additional Info** | ‚Ä¢ **Automatic Script Block Logging** enabled by default (logs only suspicious terms)<br>‚Ä¢ **Global Script Block Logging** must be manually enabled (logs ALL PowerShell)<br>‚Ä¢ Event 4104 deobfuscates code at runtime (reveals decoded malicious scripts)<br>‚Ä¢ Large scripts generate multiple 4104 events (check MessageTotal to reassemble)<br>‚Ä¢ Warning level in 4104 indicates suspicious command detected<br>‚Ä¢ Module Logging (4103) generates more noise but captures cmdlet-level detail<br>‚Ä¢ Transcription saves full session to text file (separate from event logs)<br>‚Ä¢ Common attacker techniques: encoded commands, download cradles, reflection<br>‚Ä¢ LOLBins: PowerShell used for lateral movement, credential theft, persistence<br>‚Ä¢ Combine with Sysmon Event 1 (process creation) and network logs for full picture |

---
